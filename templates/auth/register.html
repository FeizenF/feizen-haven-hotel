{% extends "base.html" %}

{% block title %}Register - Feizen Haven{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8">
        <div>
            <h2 class="mt-6 text-center text-3xl font-serif font-bold text-gray-900 dark:text-white">
                Create Your Account
            </h2>
            <p class="mt-2 text-center text-sm text-gray-600 dark:text-gray-400">
                Join Feizen Haven and start your luxury experience
            </p>
        </div>
        
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="space-y-3">
                    {% for category, message in messages %}
                        <div class="p-3 rounded-lg {% if category == 'success' %}bg-green-100 text-green-700 border border-green-200{% else %}bg-red-100 text-red-700 border border-red-200{% endif %}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <form class="mt-8 space-y-6" method="POST" action="{{ url_for('register') }}" id="registerForm">
            <!-- CSRF TOKEN -->
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            
            <div class="space-y-4">
                <!-- First & Last Name -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="first_name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            First Name *
                        </label>
                        <input id="first_name" name="first_name" type="text" required 
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 dark:bg-gray-800 placeholder-gray-500 text-gray-900 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-gold focus:border-transparent"
                               placeholder="John"
                               minlength="2">
                        <div class="text-xs text-red-500 mt-1 hidden" id="firstNameError"></div>
                    </div>
                    <div>
                        <label for="last_name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Last Name *
                        </label>
                        <input id="last_name" name="last_name" type="text" required 
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 dark:bg-gray-800 placeholder-gray-500 text-gray-900 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-gold focus:border-transparent"
                               placeholder="Doe"
                               minlength="2">
                        <div class="text-xs text-red-500 mt-1 hidden" id="lastNameError"></div>
                    </div>
                </div>
                
                <!-- Email -->
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Email Address *
                    </label>
                    <input id="email" name="email" type="email" autocomplete="email" required 
                           class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 dark:bg-gray-800 placeholder-gray-500 text-gray-900 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-gold focus:border-transparent"
                           placeholder="you@example.com">
                    <div class="text-xs text-red-500 mt-1 hidden" id="emailError"></div>
                </div>
                
                <!-- Phone -->
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Phone Number <span class="text-gray-500 text-xs">(optional)</span>
                    </label>
                    <input id="phone" name="phone" type="tel" 
                           class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 dark:bg-gray-800 placeholder-gray-500 text-gray-900 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-gold focus:border-transparent"
                           placeholder="+62 812-3456-7890">
                    <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                        Include country code (e.g., +62)
                    </div>
                </div>
                
                <!-- Password -->
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Password *
                    </label>
                    <div class="relative">
                        <input id="password" name="password" type="password" required 
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 dark:bg-gray-800 placeholder-gray-500 text-gray-900 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-gold focus:border-transparent pr-10"
                               placeholder="Minimum 8 characters">
                        <button type="button" id="togglePassword" class="absolute right-3 top-3 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                            <i id="passwordIcon" class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="text-xs text-red-500 mt-1 hidden" id="passwordError"></div>
                </div>
                
                <!-- Confirm Password -->
                <div>
                    <label for="confirm_password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Confirm Password *
                    </label>
                    <div class="relative">
                        <input id="confirm_password" name="confirm_password" type="password" required 
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-700 dark:bg-gray-800 placeholder-gray-500 text-gray-900 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-gold focus:border-transparent pr-10"
                               placeholder="Re-enter your password">
                        <button type="button" id="toggleConfirmPassword" class="absolute right-3 top-3 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                            <i id="confirmPasswordIcon" class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="text-xs text-red-500 mt-1 hidden" id="confirmPasswordError"></div>
                </div>
                
                <!-- Password Requirements -->
                <div class="bg-gradient-to-r from-gold/5 to-transparent p-4 rounded-lg border border-gold/10 dark:border-gray-700">
                    <p class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-2">
                        <i class="fas fa-info-circle text-gold mr-1"></i>
                        Password Requirements:
                    </p>
                    <ul class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
                        <li class="flex items-center" id="length-check">
                            <i class="fas fa-circle text-xs mr-2 text-gray-300 dark:text-gray-600"></i>
                            Minimum 8 characters
                        </li>
                        <li class="flex items-center" id="uppercase-check">
                            <i class="fas fa-circle text-xs mr-2 text-gray-300 dark:text-gray-600"></i>
                            At least 1 uppercase letter (A-Z)
                        </li>
                        <li class="flex items-center" id="match-check">
                            <i class="fas fa-circle text-xs mr-2 text-gray-300 dark:text-gray-600"></i>
                            Passwords must match
                        </li>
                    </ul>
                </div>
                
                <!-- Terms Agreement -->
                <div class="flex items-start mt-6">
                    <div class="flex items-center h-5">
                        <input id="terms" name="terms" type="checkbox" required
                               class="h-4 w-4 text-gold focus:ring-gold border-gray-300 rounded dark:border-gray-600">
                    </div>
                    <div class="ml-3 text-sm">
                        <label for="terms" class="text-gray-700 dark:text-gray-300">
                            I agree to the 
                            <a href="#" class="text-gold hover:text-gold/80 font-medium transition-colors">
                                Terms of Service
                            </a> 
                            and 
                            <a href="#" class="text-gold hover:text-gold/80 font-medium transition-colors">
                                Privacy Policy
                            </a>
                        </label>
                        <div class="text-xs text-red-500 mt-1 hidden" id="termsError"></div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            * Required fields
                        </p>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div>
                <button type="submit" id="submitBtn"
                        class="w-full flex justify-center items-center py-3 px-4 bg-gold text-navy font-semibold rounded-lg hover:bg-gold/90 hover:shadow-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-gold focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-user-plus mr-2"></i>
                    <span id="submitText">Create Account</span>
                </button>
            </div>
            
            <!-- Login Link -->
            <div class="text-center pt-4 border-t dark:border-gray-800">
                <p class="text-sm text-gray-600 dark:text-gray-400">
                    Already have an account?
                    <a href="{{ url_for('login') }}" class="font-medium text-gold hover:text-gold/80 transition-colors ml-1">
                        Sign in here
                    </a>
                </p>
            </div>
        </form>
    </div>
</div>

<style>
    input:focus {
        box-shadow: 0 0 0 3px rgba(197, 161, 69, 0.2);
    }
    
    .dark input:focus {
        box-shadow: 0 0 0 3px rgba(197, 161, 69, 0.3);
    }
    
    .dark .border-gray-300 {
        border-color: #4b5563;
    }
    
    /* Password requirement icons */
    .requirement-valid {
        color: #10B981; /* green-500 */
    }
    
    .requirement-invalid {
        color: #EF4444; /* red-500 */
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('registerForm');
        const password = document.getElementById('password');
        const confirmPassword = document.getElementById('confirm_password');
        const togglePassword = document.getElementById('togglePassword');
        const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
        const passwordIcon = document.getElementById('passwordIcon');
        const confirmPasswordIcon = document.getElementById('confirmPasswordIcon');
        const submitBtn = document.getElementById('submitBtn');
        const submitText = document.getElementById('submitText');
        
        // Password requirement elements
        const lengthCheck = document.getElementById('length-check');
        const uppercaseCheck = document.getElementById('uppercase-check');
        const matchCheck = document.getElementById('match-check');
        
        // Error elements
        const firstNameError = document.getElementById('firstNameError');
        const lastNameError = document.getElementById('lastNameError');
        const emailError = document.getElementById('emailError');
        const passwordError = document.getElementById('passwordError');
        const confirmPasswordError = document.getElementById('confirmPasswordError');
        const termsError = document.getElementById('termsError');
        
        // Toggle password visibility
        function togglePasswordVisibility(input, icon) {
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);
            icon.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
        }
        
        if (togglePassword) {
            togglePassword.addEventListener('click', function() {
                togglePasswordVisibility(password, passwordIcon);
            });
        }
        
        if (toggleConfirmPassword) {
            toggleConfirmPassword.addEventListener('click', function() {
                togglePasswordVisibility(confirmPassword, confirmPasswordIcon);
            });
        }
        
        // Real-time password validation
        function validatePassword() {
            const pass = password.value;
            const confirmPass = confirmPassword.value;
            let isValid = true;
            
            // Reset errors
            hideError(passwordError);
            hideError(confirmPasswordError);
            
            // Length validation
            if (pass.length >= 8) {
                lengthCheck.innerHTML = '<i class="fas fa-check-circle text-xs mr-2 text-green-500"></i>Minimum 8 characters ✓';
            } else if (pass.length > 0) {
                lengthCheck.innerHTML = '<i class="fas fa-times-circle text-xs mr-2 text-red-500"></i>Minimum 8 characters';
                isValid = false;
            } else {
                lengthCheck.innerHTML = '<i class="fas fa-circle text-xs mr-2 text-gray-300 dark:text-gray-600"></i>Minimum 8 characters';
            }
            
            // Uppercase validation
            if (/[A-Z]/.test(pass)) {
                uppercaseCheck.innerHTML = '<i class="fas fa-check-circle text-xs mr-2 text-green-500"></i>At least 1 uppercase letter ✓';
            } else if (pass.length > 0) {
                uppercaseCheck.innerHTML = '<i class="fas fa-times-circle text-xs mr-2 text-red-500"></i>At least 1 uppercase letter (A-Z)';
                isValid = false;
            } else {
                uppercaseCheck.innerHTML = '<i class="fas fa-circle text-xs mr-2 text-gray-300 dark:text-gray-600"></i>At least 1 uppercase letter (A-Z)';
            }
            
            // Match validation
            if (pass && confirmPass) {
                if (pass === confirmPass) {
                    matchCheck.innerHTML = '<i class="fas fa-check-circle text-xs mr-2 text-green-500"></i>Passwords match ✓';
                } else {
                    matchCheck.innerHTML = '<i class="fas fa-times-circle text-xs mr-2 text-red-500"></i>Passwords do not match';
                    isValid = false;
                }
            } else {
                matchCheck.innerHTML = '<i class="fas fa-circle text-xs mr-2 text-gray-300 dark:text-gray-600"></i>Passwords must match';
            }
            
            return isValid;
        }
        
        // Real-time email validation
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        // Real-time name validation
        function validateName(name, fieldName) {
            return name.length >= 2;
        }
        
        // Show error helper
        function showError(element, message) {
            element.textContent = message;
            element.classList.remove('hidden');
        }
        
        // Hide error helper
        function hideError(element) {
            element.textContent = '';
            element.classList.add('hidden');
        }
        
        // Form validation on input
        password.addEventListener('input', validatePassword);
        confirmPassword.addEventListener('input', validatePassword);
        
        // First name validation
        document.getElementById('first_name').addEventListener('input', function() {
            const firstName = this.value.trim();
            if (firstName.length > 0 && !validateName(firstName, 'first_name')) {
                showError(firstNameError, 'First name must be at least 2 characters');
            } else {
                hideError(firstNameError);
            }
        });
        
        // Last name validation
        document.getElementById('last_name').addEventListener('input', function() {
            const lastName = this.value.trim();
            if (lastName.length > 0 && !validateName(lastName, 'last_name')) {
                showError(lastNameError, 'Last name must be at least 2 characters');
            } else {
                hideError(lastNameError);
            }
        });
        
        // Email validation
        document.getElementById('email').addEventListener('input', function() {
            const email = this.value.trim();
            if (email.length > 0 && !validateEmail(email)) {
                showError(emailError, 'Please enter a valid email address');
            } else {
                hideError(emailError);
            }
        });
        
        // Form submission
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Reset all errors
            [firstNameError, lastNameError, emailError, passwordError, confirmPasswordError, termsError].forEach(hideError);
            
            // Get form values
            const firstName = document.getElementById('first_name').value.trim();
            const lastName = document.getElementById('last_name').value.trim();
            const email = document.getElementById('email').value.trim();
            const pass = password.value;
            const confirmPass = confirmPassword.value;
            const termsChecked = document.getElementById('terms').checked;
            
            let isValid = true;
            
            // Validate first name
            if (!firstName) {
                showError(firstNameError, 'First name is required');
                isValid = false;
            } else if (!validateName(firstName, 'first_name')) {
                showError(firstNameError, 'First name must be at least 2 characters');
                isValid = false;
            }
            
            // Validate last name
            if (!lastName) {
                showError(lastNameError, 'Last name is required');
                isValid = false;
            } else if (!validateName(lastName, 'last_name')) {
                showError(lastNameError, 'Last name must be at least 2 characters');
                isValid = false;
            }
            
            // Validate email
            if (!email) {
                showError(emailError, 'Email is required');
                isValid = false;
            } else if (!validateEmail(email)) {
                showError(emailError, 'Please enter a valid email address');
                isValid = false;
            }
            
            // Validate password
            if (!pass) {
                showError(passwordError, 'Password is required');
                isValid = false;
            } else if (pass.length < 8) {
                showError(passwordError, 'Password must be at least 8 characters long');
                isValid = false;
            } else if (!/[A-Z]/.test(pass)) {
                showError(passwordError, 'Password must contain at least one uppercase letter');
                isValid = false;
            }
            
            // Validate confirm password
            if (!confirmPass) {
                showError(confirmPasswordError, 'Please confirm your password');
                isValid = false;
            } else if (pass !== confirmPass) {
                showError(confirmPasswordError, 'Passwords do not match');
                isValid = false;
            }
            
            // Validate terms
            if (!termsChecked) {
                showError(termsError, 'You must agree to the Terms of Service and Privacy Policy');
                isValid = false;
            }
            
            if (isValid) {
                // Disable submit button and show loading
                submitBtn.disabled = true;
                submitText.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Creating Account...';
                
                // Submit form
                form.submit();
            }
        });
        
        // Initial validation
        validatePassword();
    });
</script>
{% endblock %}